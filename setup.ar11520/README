Here we describe the steps to set up the quasi-steady initial state with an initial
potential magnetic field and a hot corona:

(1) Edit and run pdfi2mhd_rebin_chromfix.pro in IDL to
read in a snapshot from the PDFI data to initialize and write out a MFE grid (rebinned), `
grid_in.dat, and physparams.dat file, and the lower boundary normal magnetic field
lbdata.dat in the <INITDATA_DIR> specified in pdfi2mhd_rebin_chromfix.pro

After running pdfi2mhd_rebin_chromfix.pro in IDL, you can further run the program
mkfig_sph_mgram.pro
to plot two images: an image of the vector magnetogram, and an image of the vector
horizontal field overlaid over vertical electric current density jr, and the two
images will be written as .png files and .eps files to the <INITDATA_DIR>

(2) Run the FORTRAN codes in this directory to compute the initial state
for the MFE relaxation run:

make xinit

Edit the inpram_initvg file to specify the paths <INITDATA_DIR> for input/output files

Run the excecutable:
./xinit >& log_init &

It will compute an initial potential magnetic field with a 1-d static atmosphere
as a set of data files (*_0000.dat) and a grid file (grid.dat), written in the
directory <INITDATA_DIR> (specified in inparam_initvg)

(3) Compute the random electric field 

create a data directory <XIDATA_DIR> where the xi field for the
random electric field will be stored: mkdir <XIDATA_DIR>

Compile the code getxi_forpdfi_1.f90 by typing:
source comp_getxi

Edit the input parameter file inparam_getxi to specify the
path for the grid.dat in the <INITDATA_DIR>
and the path <XIDATA_DIR> for the output xi field files

run the compiled executable:
a.out >& log &
Results (xi_XXXX.dat) will be written in the directory <XIDATA_DIR>
specified in inparam_getxi.

Edit (to specify the <XIDATA_DIR> path) and run the idl code
getslcs_stitch_pdfi_chromfix.pro in IDL, which combines the xi_XXXX.dat files
into files, each of which contains 50 xi time slices, and writes them
in the <XIDATA_DIR>.

(4) Do the MFE relaxation run to set up the initial state: 

Create run directory <RUNINIT_DIR> and cd to the <RUNINIT_DIR>
and execute the following commands to copy the data files from
the <INITDATA_DIR> to the current <RUNINIT_DIR>:

cp -p <INIDATA_DIR>/b1_0000.dat b1_rst.dat
cp -p <INIDATA_DIR>/b2_0000.dat b2_rst.dat
cp -p <INIDATA_DIR>/b3_0000.dat b3_rst.dat
cp -p <INIDATA_DIR>/v1_0000.dat v1_rst.dat
cp -p <INIDATA_DIR>/v2_0000.dat v2_rst.dat
cp -p <INIDATA_DIR>/v3_0000.dat v3_rst.dat
cp -p <INIDATA_DIR>/d_0000.dat d_rst.dat
cp -p <INIDATA_DIR>/e_0000.dat e_rst.dat
cp -p <INIDATA_DIR>/q1_0000.dat q_rst.dat
cp -p <INIDATA_DIR>/grid_in.dat grid_in.dat

(note to replace <INITDATA_DIR> with your actual path for the <INITDATA_DIR>)

Then excecute the following commands to copy the random electric field data
from the <XIDATA_DIR> to the current <RUNINIT_DIR>:

cp -p <XIDATA_DIR>/xislc1*.dat .
cp -p <XIDATA_DIR>/timetable .

Then cd to the MFE source directory (the cloned mfe_expand1 directory)
and copy the files (ModPar.F ModUserSetup.F ModNonIdealRHS.F makefile) from the
probs/AR111520/relax directory to the current MFE source directory.

Compile the MFE code by typing: make xmfe

Copy the executable "xmfe" to the <RUNINIT_DIR>

Copy the example pbscript file (pbsscript_derecho) and the inparam file from the
probs/AR111520/relax/rundir to the <RUNINIT_DIR>

cd to <RUNINIT_DIR>

Edit the pbsscript file (depending on the machine and the batch queue system)
and the inparam file for the necessary changes

Run the executable xmfe by submitting the pbsscript e.g.:
qsub pbsscript_derecho

The final state data files from this run will be used as the
initial state for the subsequent driving simulation (driven
with the additional twisting electric field).
